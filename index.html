<!DOCTYPE html>
<html>

<head>
    <title>AR Sketch Overlay</title>
    <!-- Use stable versions -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body style="margin: 0; overflow: hidden;">

    <!-- UI Overlay for controls -->
    <div class="ui-overlay">
        <div class="header">
            <h1>AR Sketch</h1>
            <p id="status-text">Initializing AR...</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Opacity</label>
                <input type="range" id="opacity-slider" min="0" max="1" step="0.1" value="0.7">
            </div>
            <div class="control-group">
                <label>Scale</label>
                <input type="range" id="scale-slider" min="0.1" max="5" step="0.1" value="1">
            </div>
            <div class="control-group">
                <label>Rotation</label>
                <input type="range" id="rotation-slider" min="0" max="360" step="10" value="90">
            </div>
        </div>
    </div>

    <!-- AR Scene -->
    <!-- debugUIEnabled: true helps to see if camera is working and detecting markers -->
    <!-- renderer="logarithmicDepthBuffer: true;" helps with z-fighting -->
    <a-scene embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; colorManagement: true;">

        <!-- Marker Handler -->
        <!-- 'emitevents' attribute allows us to listen for markerFound/Lost -->
        <a-marker preset="hiro" id="marker-root" emitevents="true">
            <!-- The Overlay Image -->
            <!-- Added a plane to make it more visible if the image fails for some reason -->
            <a-plane position="0 0 0" rotation="-90 0 0" width="1" height="1" color="white" opacity="0.1"></a-plane>

            <!-- Image: explicitly double check rotation. -90 on X makes it flat. -->
            <a-image id="overlay-entity" src="overlay_image.jpg" position="0 0.1 0" rotation="-90 90 0" scale="1 1 1"
                opacity="0.8">
            </a-image>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script src="script.js"></script>

    <!-- Debug script to show status -->
    <script>
        const marker = document.querySelector("#marker-root");
        const statusText = document.querySelector("#status-text");

        marker.addEventListener("markerFound", (e) => {
            console.log("Marker Found");
            statusText.innerText = "Marker Found!";
            statusText.style.color = "#4ade80";
        });

        marker.addEventListener("markerLost", (e) => {
            console.log("Marker Lost");
            statusText.innerText = "Searching for Hiro Marker...";
            statusText.style.color = "#cbd5e1";
        });
    </script>
</body>

</html>